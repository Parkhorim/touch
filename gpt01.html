<!doctype html>
state.exported = buildExportObject();
}


const obj = state.exported || buildExportObject();


$('#leftBody').innerHTML = `
<div class="sub">
<h3>최종 설계도</h3>
<div class="out" id="finalOut">${escapeHTML(state.planText)}</div>
<div class="footer">
<button class="primary" id="btnCopy">클립보드 복사</button>
<button id="btnJson">JSON 다운로드</button>
<button id="btnPrint2">인쇄(PDF)</button>
</div>
</div>


<div class="sub" style="margin-top:10px">
<h3>제출용 체크(권장)</h3>
<ul style="margin:8px 0 0 18px; color:#dfe6ff; font-size:12px; line-height:1.55">
<li>정량 근거 1개 이상(참여/수행/루브릭 중 1개)</li>
<li>정성 근거 1개 이상(관찰 메모/학생 반응/협업 기록 등)</li>
<li>개입 전략 2개 이상(도구/활동/피드백 루틴)</li>
<li>측정 가능한 성장 지표 1개 이상</li>
</ul>
</div>
`;


$('#btnCopy').addEventListener('click', ()=> copyToClipboard(state.planText));
$('#btnJson').addEventListener('click', ()=> downloadJSON(obj));
$('#btnPrint2').addEventListener('click', ()=> window.print());
}


function render(){
const p = selectedPersona();
$('#selName').textContent = p ? `${p.name}(${p.label})` : '없음';
renderRight();


if(state.step===1) renderStep1();
if(state.step===2) renderStep2();
if(state.step===3) renderStep3();
if(state.step===4) renderStep4();


// 다음 버튼
const next = $('#btnNext');
next.textContent = state.step===4 ? '처음으로' : '다음';
next.onclick = ()=>{
if(state.step===4) setStep(1);
else {
if(state.step===1 && !state.selectedId) return alert('페르소나를 먼저 선택하세요.');
setStep(state.step+1);
}
};
}


// -------------------------
// HTML escape
// -------------------------
function escapeHTML(s){
return String(s ?? '')
.replaceAll('&','&amp;')
.replaceAll('<','&lt;')
.replaceAll('>','&gt;')
.replaceAll('"','&quot;')
.replaceAll("'",'&#039;');
}


// -------------------------
// 상단 버튼/탭 이벤트
// -------------------------
$$('.tab').forEach(t=> t.addEventListener('click', ()=>{
const n = Number(t.dataset.step);
if(n>1 && !state.selectedId) return alert('S1에서 페르소나를 먼저 선택하세요.');
setStep(n);
}));


$('#btnReset').addEventListener('click', ()=>{
if(confirm('모든 입력을 초기화할까요?')) resetAll();
});


$('#btnPrint').addEventListener('click', ()=> window.print());


$('#btnHelp').addEventListener('click', ()=>{
alert(
`사용 방법(연수 운영용):\n\n1) S1에서 모둠별 페르소나 선택\n2) S2에서 정량/정성 근거로 호소 문제·가설·근거 메모 작성\n3) ‘AI/룰 기반 추천 생성’으로 개입 초안 생성\n4) S3에서 설계도 문장을 모둠 토론 결과로 수정\n5) S4에서 복사/JSON/PDF로 제출\n\n팁: 근거 없는 주장 방지를 위해 ‘근거 연결 메모’를 필수로 운영하세요.`
);
});


// 초기 렌더
render();
</script>
</body>
</html>
